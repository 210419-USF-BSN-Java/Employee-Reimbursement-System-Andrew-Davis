<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Home</title>

        <!-- Site wide styles -->
        <link rel="stylesheet" href="static/styles/style_login.css">

        <!-- Page specific styles -->
        <!-- <script src="static/scripts/script_login.js" defer></script> -->
        <script src="static/scripts/script_login_style.js" defer></script>

        <!-- Site wide scripts -->
        <script src="static/scripts/script_all.js" defer></script>

        <!-- Page specific scripts -->

    </head>
    <body>
        <div class="div-body">
            <div class="div-picture-body"></div>
            <div class="div-menu-body">
                <div class="div-form-menu">
                    <div class="div-input-form">
                        <label>Username</label>
                        <br>
                        <input type="text" class="input-username">
                        <br>
                        <br>
                        <label>Password</label>
                        <br>
                        <input type="password" class="input-password">
                        <br>
                        <br>
                        <input type="button" id="input-login" value="Login">
                    </div>
                </div>
                <div class="div-logo-menu">

                </div>
            </div>
        </div>




        <script>
            document.getElementById("input-login").addEventListener("click", requestLogin);

            function requestLogin() {
                let user = document.querySelector(".input-username").value;
                let pass = document.querySelector(".input-password").value;
                
                let xhr = new XMLHttpRequest();
                let url = "http://localhost:8080/Project1/login";
                xhr.open("POST", url);
                
                xhr.onreadystatechange = function(){
                    if(xhr.readyState == 4 && xhr.status == 200){
                        let auth = xhr.getResponseHeader("Authorization");
                        /*
                            session is a storage that lasts for that specific page session(tab)
                            here we store our auth token
                        */
                        sessionStorage.setItem("token", auth);
                        /*
                            if the login is successful, redirects to the home page
                        */
                        // You will need to differentiate between and employee and manager
                        let sessionVariable = sessionStorage.getItem("token");
                        let tokenArr = []
                        tokenArr = sessionVariable.split(":");

                        if(tokenArr[1] == "Employee") {
                            window.location.href="http://localhost:8080/Project1/employee"
                        }
                        else if(tokenArr[1] == "Manager") {
                            window.location.href="http://localhost:8080/Project1/manager"
                        }
                    } 
                    else if (xhr.readyState == 4){
                        document.getElementById('message').innerHTML='Incorrect credentials!';
                    }
                }
                
                /*
                    Allows us to send form data as a single block in the body rather than as query params in the URL
                */
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                let requestBody = `username=${user}&password=${pass}`;
                xhr.send(requestBody);
            }
        </script>
    </body>
</html>
